{"openapi":"3.0.0","info":{"title":"Roomi Devices","description":"Device management and control API for Roomi smart home system","version":"1.0.0","x-aws-sigv4-info":"AWS SigV4 Authentication: Requests must include Authorization header with AWS4-HMAC-SHA256 signature, X-Amz-Content-Sha256 header with request body hash, and X-Amz-Date header with ISO8601 timestamp. Region: me-central-1, Service: execute-api. Additionally, all requests require x-unit-id and x-user-id headers."},"servers":[{"url":"https://devices-{env}-ae.roomi-services.com","description":"Live server"},{"url":"http://localhost:3000","description":"Local development server"}],"tags":[{"name":"Health","description":"Health check endpoints"},{"name":"Device Management","description":"Device CRUD and control operations"},{"name":"Room Management","description":"Room and device organization operations"}],"paths":{"/api/health":{"get":{"tags":["Health"],"summary":"Health check","description":"Check if the API server is running and responsive","responses":{"200":{"description":"OK"}}}},"/api/devices":{"get":{"tags":["Device Management"],"summary":"Get all devices for a unit","description":"Retrieve all devices associated with a specific unit and user. Requires x-unit-id and x-user-id headers for authentication.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"List of devices retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string","example":"Living Room Lights"},"unitId":{"type":"string","example":"unit-12345"},"room":{"type":"string","example":"Living Room"},"brand":{"type":"string","example":"lifesmart"},"status":{"type":"string","example":"online"},"type":{"type":"string","example":"light"}}}},"example":[{"name":"Living Room Lights","unitId":"unit-12345","room":"Living Room","brand":"lifesmart","status":"online","type":"light"}]}}},"400":{"description":"Missing required headers","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Missing required headers"}}}},"500":{"description":"Failed to fetch devices","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Failed to fetch devices"}}}}}},"post":{"tags":["Device Management"],"summary":"Update device data","description":"Update device settings and control states. Allows changing device parameters like brightness, temperature, or switching states. Requires x-unit-id and x-user-id headers for authentication.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Device updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"message":{"type":"string"}}},"example":{"success":true,"message":"Device updated successfully"}}}},"400":{"description":"Missing required headers or invalid request data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Missing required headers"}}}},"500":{"description":"Internal Server Error"}},"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"user_id":{"type":"string"},"unit_id":{"type":"string"},"data":{"type":"object","properties":{"devices":{"type":"array","items":{"type":"object","properties":{"deviceId":{"type":"string"},"targetValue":{"type":"string"},"actionType":{"type":"string"},"actionId":{"type":"number"}}}}}}}},"example":{"user_id":"user-123","unit_id":"unit-456","data":{"devices":[{"deviceId":"device-456","targetValue":"100","actionType":"set_brightness","actionId":1}]}}}}}}},"/api/devices/{me}":{"get":{"tags":["Device Management"],"summary":"Get device by ME identifier","description":"Retrieve a specific device using its ME (device identifier). Requires x-unit-id and x-user-id headers for authentication.","parameters":[{"name":"me","in":"path","required":true,"schema":{"type":"string"},"description":"Device identifier","example":"device-456"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Device retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","example":"Bedroom Light"},"unitId":{"type":"string","example":"unit-12345"},"room":{"type":"string","example":"Bedroom"},"brand":{"type":"string","example":"lifesmart"},"status":{"type":"string","example":"online"},"type":{"type":"string","example":"light"}}},"example":{"name":"Bedroom Light","unitId":"unit-12345","room":"Bedroom","brand":"lifesmart","status":"online","type":"light"}}}},"400":{"description":"Bad Request"},"500":{"description":"Internal Server Error"}}}},"/api/devices/messages/unit":{"get":{"tags":["Device Management"],"summary":"Get device messages for unit","description":"Retrieve all device-related messages and notifications for a specific unit. Includes status updates, alerts, and communication logs.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Device messages retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"messageId":{"type":"string"},"deviceId":{"type":"string"},"message":{"type":"string"},"timestamp":{"type":"string","format":"date-time"},"type":{"type":"string"}}}},"example":[{"messageId":"msg-123","deviceId":"device-456","message":"Device status updated","timestamp":"2024-01-15T10:30:00Z","type":"status_update"},{"messageId":"msg-124","deviceId":"device-789","message":"Device turned on","timestamp":"2024-01-15T10:35:00Z","type":"action"}]}}},"400":{"description":"Bad Request"},"500":{"description":"Internal Server Error"}}}},"/api/rooms":{"get":{"tags":["Room Management"],"summary":"Get all rooms with device details","description":"Retrieve all rooms for a unit with their associated device information. Returns room details including device counts and basic device information.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Rooms retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}},"devices":{"type":"array","items":{"type":"object","properties":{"me":{"type":"string"},"name":{"type":"string"}}}}}}},"example":[{"roomId":"550e8400-e29b-41d4-a716-446655440000","roomName":"Living Room","roomFloor":"Ground Floor","deviceMes":["device-123","device-456"],"devices":[{"me":"device-123","name":"Living Room Light"},{"me":"device-456","name":"Living Room Fan"}]}]}}},"400":{"description":"Missing required headers","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Missing required headers"}}}},"500":{"description":"Failed to fetch rooms","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Failed to fetch rooms"}}}}}},"post":{"tags":["Room Management"],"summary":"Create a new room","description":"Create a new room in the unit with specified name, floor, and optional device assignments.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"roomName":{"type":"string","description":"Name of the room"},"roomFloor":{"type":"string","description":"Floor where the room is located"},"deviceMes":{"type":"array","items":{"type":"string"},"description":"Array of device identifiers to assign to this room"}},"required":["roomName"]},"example":{"roomName":"Home Office","roomFloor":"First Floor","deviceMes":["device-789","device-101"]}}}},"responses":{"201":{"description":"Room created successfully","content":{"application/json":{"schema":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}}}},"example":{"roomId":"550e8400-e29b-41d4-a716-446655440000","roomName":"Home Office","roomFloor":"First Floor","deviceMes":["device-789","device-101"]}}}},"400":{"description":"Bad Request - Room already exists or invalid data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Room already exists"}}}},"500":{"description":"Internal Server Error"}}}},"/api/rooms/{roomId}":{"get":{"tags":["Room Management"],"summary":"Get a specific room with device details","description":"Retrieve a specific room by its ID with detailed device information.","parameters":[{"name":"roomId","in":"path","required":true,"schema":{"type":"string"},"description":"Room identifier","example":"LIVINGROOM"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Room retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}},"devices":{"type":"array","items":{"type":"object","properties":{"me":{"type":"string"},"name":{"type":"string"}}}}}},"example":{"roomId":"LIVINGROOM","roomName":"Living Room","roomFloor":"Ground Floor","deviceMes":["device-123","device-456"],"devices":[{"me":"device-123","name":"Living Room Light"},{"me":"device-456","name":"Living Room Fan"}]}}}},"400":{"description":"Bad Request"},"404":{"description":"Room not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Room not found"}}}},"500":{"description":"Internal Server Error"}}},"put":{"tags":["Room Management"],"summary":"Update a room","description":"Update room information including name, floor, and device assignments. When room name is changed, all associated devices are updated accordingly.","parameters":[{"name":"roomId","in":"path","required":true,"schema":{"type":"string"},"description":"Room identifier","example":"LIVINGROOM"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"roomName":{"type":"string","description":"New name for the room"},"roomFloor":{"type":"string","description":"New floor for the room"},"deviceMes":{"type":"array","items":{"type":"string"},"description":"Array of device identifiers to assign to this room"}}},"example":{"roomName":"Updated Living Room","roomFloor":"Ground Floor","deviceMes":["device-123","device-456","device-789"]}}}},"responses":{"200":{"description":"Room updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"updatedRoom":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}}}},"updatedDevices":{"type":"array","items":{"type":"object","properties":{"deviceId":{"type":"string"},"success":{"type":"boolean"}}}}}},"example":{"message":"Room updated successfully","updatedRoom":{"roomId":"550e8400-e29b-41d4-a716-446655440000","roomName":"Updated Living Room","roomFloor":"Ground Floor","deviceMes":["device-123","device-456","device-789"]},"updatedDevices":[{"deviceId":"device-123","success":true},{"deviceId":"device-456","success":true}]}}}},"400":{"description":"Bad Request - Room not found or invalid data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Room not found"}}}},"500":{"description":"Internal Server Error"}}},"delete":{"tags":["Room Management"],"summary":"Delete a room","description":"Delete a room and move all its devices to 'Unassigned Devices' category. This operation cannot be undone.","parameters":[{"name":"roomId","in":"path","required":true,"schema":{"type":"string"},"description":"Room identifier","example":"LIVINGROOM"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Room deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"deletedRoom":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}}}},"movedDevices":{"type":"array","items":{"type":"object","properties":{"deviceId":{"type":"string"},"success":{"type":"boolean"}}}},"movedTo":{"type":"string"}}},"example":{"message":"Room deleted successfully","deletedRoom":{"roomId":"550e8400-e29b-41d4-a716-446655440000","roomName":"Old Room","roomFloor":"Ground Floor","deviceMes":["device-123","device-456"]},"movedDevices":[{"deviceId":"device-123","success":true},{"deviceId":"device-456","success":true}],"movedTo":"Unassigned Devices"}}}},"400":{"description":"Bad Request - Room not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Room not found"}}}},"500":{"description":"Internal Server Error"}}}},"/api/rooms/{roomId}/floor":{"patch":{"tags":["Room Management"],"summary":"Update room floor","description":"Update the floor assignment for a specific room.","parameters":[{"name":"roomId","in":"path","required":true,"schema":{"type":"string"},"description":"Room identifier","example":"LIVINGROOM"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"floor":{"type":"string","description":"New floor name for the room"}},"required":["floor"]},"example":{"floor":"Second Floor"}}}},"responses":{"200":{"description":"Room floor updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"roomId":{"type":"string"},"roomName":{"type":"string"},"roomFloor":{"type":"string"},"deviceMes":{"type":"array","items":{"type":"string"}}}},"example":{"roomId":"550e8400-e29b-41d4-a716-446655440000","roomName":"Living Room","roomFloor":"Second Floor","deviceMes":["device-123","device-456"]}}}},"400":{"description":"Bad Request - Room not found or missing floor parameter","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Room not found"}}}},"500":{"description":"Internal Server Error"}}}},"/api/rooms/move":{"post":{"tags":["Room Management"],"summary":"Move devices to a room","description":"Move multiple devices to a specific room. Devices are removed from their current room and assigned to the target room.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"deviceIds":{"type":"array","items":{"type":"string"},"description":"Array of device identifiers to move"},"roomId":{"type":"string","description":"Target room identifier"}},"required":["deviceIds","roomId"]},"example":{"deviceIds":["device-123","device-456","device-789"],"roomId":"LIVINGROOM"}}}},"responses":{"200":{"description":"All devices moved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"results":{"type":"array","items":{"type":"object","properties":{"deviceId":{"type":"string"},"success":{"type":"boolean"},"previousRoom":{"type":"string"},"newRoom":{"type":"string"}}}}}},"example":{"message":"All devices moved successfully","results":[{"deviceId":"device-123","success":true,"previousRoom":"Bedroom","newRoom":"Living Room"},{"deviceId":"device-456","success":true,"previousRoom":"Kitchen","newRoom":"Living Room"}]}}}},"207":{"description":"Some devices failed to move","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"success":{"type":"boolean"},"results":{"type":"array","items":{"type":"object","properties":{"deviceId":{"type":"string"},"success":{"type":"boolean"},"error":{"type":"string"}}}}}},"example":{"message":"Some devices failed to move","success":false,"results":[{"deviceId":"device-123","success":true,"previousRoom":"Bedroom","newRoom":"Living Room"},{"deviceId":"device-456","success":false,"error":"Device not found"}]}}}},"400":{"description":"Bad Request - Missing parameters or invalid data","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"deviceIds must be a non-empty array"}}}},"500":{"description":"Internal Server Error"}}}},"/api/floors":{"get":{"tags":["Room Management"],"summary":"Get all floors","description":"Retrieve all unique floor names from all rooms in the unit.","parameters":[{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"responses":{"200":{"description":"Floors retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"type":"string"}},"example":["Ground Floor","First Floor","Second Floor","Basement"]}}},"400":{"description":"Bad Request - Missing required headers","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Unit ID and User ID are required"}}}},"500":{"description":"Failed to fetch floors","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Failed to fetch floors"}}}}}}},"/api/floors/{floorName}":{"put":{"tags":["Room Management"],"summary":"Update floor name","description":"Update the floor name across all rooms that currently have the specified floor name. This operation updates all rooms simultaneously.","parameters":[{"name":"floorName","in":"path","required":true,"schema":{"type":"string"},"description":"Current floor name to update","example":"Ground Floor"},{"name":"x-unit-id","in":"header","description":"Unit identifier","required":true,"example":"unit-12345","schema":{"type":"string"}},{"name":"x-user-id","in":"header","description":"User identifier","required":true,"example":"user-67890","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"newFloorName":{"type":"string","description":"New floor name to replace the current one"}},"required":["newFloorName"]},"example":{"newFloorName":"Main Floor"}}}},"responses":{"200":{"description":"Floor name updated successfully","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"message":{"type":"string"},"updatedCount":{"type":"number"}}},"example":{"success":true,"message":"Updated floor name in 3 rooms","updatedCount":3}}}},"400":{"description":"Bad Request - Missing parameters or floor not found","content":{"application/json":{"schema":{"type":"object","properties":{"error":{"type":"string"}}},"example":{"error":"Missing required parameters"}}}},"500":{"description":"Internal Server Error"}}}}},"components":{"securitySchemes":{"AWSSignatureV4":{"type":"apiKey","in":"header","name":"Authorization","description":"AWS Signature Version 4 authorization header (e.g., AWS4-HMAC-SHA256 Credential=...)"},"AWSContentSha256":{"type":"apiKey","in":"header","name":"X-Amz-Content-Sha256","description":"SHA256 hash of the request body"},"AWSDate":{"type":"apiKey","in":"header","name":"X-Amz-Date","description":"ISO8601 timestamp for the request (e.g., 20230101T120000Z)"}},"schemas":{}},"security":[{"AWSSignatureV4":[],"AWSContentSha256":[],"AWSDate":[]}]}