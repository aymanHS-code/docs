---
title: "AI Service API"
description: "Complete API reference for Roomi's AI service - the central intelligence that orchestrates all other services"
---

## Overview

The AI service is the central intelligence of the Roomi platform. It processes natural language commands, makes intelligent decisions, and orchestrates actions across all other services. The AI service acts as the brain of the system, understanding user intent and coordinating responses from devices, services, and external APIs.

## Base URL

```
https://ai-{environment}-{region}.roomi-services.com/v1/
```

## Authentication

All API endpoints require AWS Signature Version 4 (SigV4) authentication:

```http
Authorization: AWS4-HMAC-SHA256 Credential=YOUR_ACCESS_KEY/20240115/me-central-1/execute-api/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=YOUR_SIGNATURE
X-Amz-Content-Sha256: SHA256_HASH_OF_REQUEST_BODY
X-Amz-Date: 20240115T120000Z
```

## Core Capabilities

### Natural Language Processing
The AI service understands and processes natural language commands in multiple languages, converting them into actionable system commands.

### Service Orchestration
The AI coordinates with all other Roomi services:
- **Devices Service**: Controls smart home devices
- **Handler Service**: Manages data and communication
- **Auth Service**: Validates user permissions
- **Services Platform**: Integrates with third-party APIs

### Context Awareness
The AI maintains conversation context and user preferences to provide personalized responses and intelligent automation.

### Background Task Management
Long-running operations are handled asynchronously with status tracking and progress monitoring.

## API Endpoints

### Health Check

<Endpoint method="GET" path="/health" />

Check the health status of the AI service.

**Response:**
```json
{
  "status": "healthy",
  "message": "AI service is operational",
  "timestamp": "2024-01-15T10:00:00Z"
}
```

### Process Message

<Endpoint method="POST" path="/roomi" />

Process a natural language message and return an intelligent response with coordinated actions.

**Request Body:**
```json
{
  "user_id": "user-123",
  "unit_id": "unit-456",
  "unit_name": "Apartment 101",
  "transcript": "Turn on the living room lights and set temperature to 22 degrees",
  "thread_id": "e0f5308e-0bd9-4dc9-b55d-5c74798283bf"
}
```

**Response:**
```json
{
  "response": "I've turned on the living room lights and set the temperature to 22 degrees for you.",
  "background_tasks": [
    {
      "task_id": "task-789",
      "type": "device_control",
      "status": "completed"
    }
  ],
  "query_type": "DEVICE_CONTROL",
  "query_types": ["DEVICE_CONTROL", "TEMPERATURE_SETTING"],
  "transcript_parts": [
    "Turn on the living room lights",
    "set temperature to 22 degrees"
  ],
  "actions_taken": [
    {
      "service": "devices",
      "action": "turn_on",
      "target": "living_room_lights",
      "status": "success"
    },
    {
      "service": "devices",
      "action": "set_temperature",
      "target": "thermostat",
      "value": 22,
      "status": "success"
    }
  ]
}
```

### Task Status

<Endpoint method="GET" path="/task/{task_id}/status" />

Check the status of a background task.

**Response:**
```json
{
  "task_id": "task-789",
  "status": "completed",
  "message": "All requested actions completed successfully",
  "progress": 100,
  "result": {
    "devices_controlled": 2,
    "services_contacted": 1
  },
  "error": null
}
```

### Platform Information

<Endpoint method="GET" path="/platform" />

Get platform information including architecture and optimization details.

**Response:**
```json
{
  "status": "operational",
  "platform": "Roomi AI Service",
  "architecture": "x86_64",
  "amd64_optimized": true,
  "workers": 8,
  "version": "1.0.0",
  "capabilities": [
    "natural_language_processing",
    "service_orchestration",
    "context_management",
    "background_tasks"
  ]
}
```

### ElevenLabs Webhook

<Endpoint method="POST" path="/elevenlabs/webhook" />

Handle webhook notifications from ElevenLabs for voice synthesis.

**Request Body:**
```json
{
  "audio_url": "https://api.elevenlabs.io/v1/text-to-speech/...",
  "text": "I've turned on the living room lights",
  "voice_id": "voice-123",
  "status": "completed"
}
```

**Response:**
```json
{
  "response": "Audio processed successfully",
  "background_tasks": [
    {
      "task_id": "audio-task-456",
      "type": "voice_synthesis",
      "status": "completed"
    }
  ]
}
```

## Query Types

The AI service can handle various types of queries and intents:

| Query Type | Description | Example Commands |
|------------|-------------|------------------|
| `GENERAL` | General conversation and assistance | "Hello", "How are you?", "What can you do?" |
| `DEVICE_CONTROL` | Smart home device control | "Turn on the lights", "Set thermostat to 22" |
| `INFORMATION` | Information requests | "What's the weather?", "Show me my schedule" |
| `ROUTINE` | Routine management | "Create a morning routine", "Start bedtime routine" |
| `PAYMENT` | Payment and billing queries | "Show my bills", "Pay maintenance fee" |
| `COMPLAINT` | Complaint and maintenance | "Report a leak", "Submit maintenance request" |
| `FACILITY` | Facility booking | "Book the pool", "Check gym availability" |
| `EVENT` | Event management | "Show community events", "RSVP to meeting" |

## Service Orchestration

The AI service coordinates with other services through the Handler service:

### Device Control Flow
```
User Command → AI Service → Handler Service → Devices Service → Smart Device
```

### Information Retrieval Flow
```
User Query → AI Service → Handler Service → Services Platform → External API
```

### Authentication Flow
```
User Request → AI Service → Handler Service → Auth Service → User Validation
```

## Background Tasks

Long-running operations are handled asynchronously:

### Task Status Values
- `pending`: Task is queued for processing
- `running`: Task is currently being executed
- `completed`: Task finished successfully
- `failed`: Task encountered an error
- `cancelled`: Task was cancelled by user or system

### Task Types
- `device_control`: Controlling smart home devices
- `data_sync`: Synchronizing data between services
- `voice_synthesis`: Processing voice responses
- `external_api`: Calling third-party services
- `routine_execution`: Running automated routines

## Error Handling

### Common Error Responses

| Status Code | Description | Solution |
|-------------|-------------|----------|
| `400` | Bad Request | Check request format and required fields |
| `401` | Unauthorized | Verify AWS credentials and signature |
| `422` | Validation Error | Validate request parameters |
| `429` | Rate Limited | Implement exponential backoff |
| `500` | Internal Server Error | Contact support if persistent |

### Error Response Format

```json
{
  "error": "Error message describing what went wrong",
  "error_code": "VALIDATION_ERROR",
  "details": {
    "field": "transcript",
    "issue": "Required field missing"
  },
  "timestamp": "2024-01-15T10:00:00Z"
}
```

## Rate Limiting

The AI service implements intelligent rate limiting:

- **General Requests**: 100 requests per minute per user
- **Background Tasks**: 50 task creations per minute per user
- **Voice Processing**: 20 voice requests per minute per user
- **Service Orchestration**: 200 orchestration calls per minute per unit

## Best Practices

### 1. Context Management
```javascript
// Maintain conversation context
const threadId = 'e0f5308e-0bd9-4dc9-b55d-5c74798283bf';

const response1 = await fetch('/v1/roomi', {
  method: 'POST',
  body: JSON.stringify({
    user_id: 'user-123',
    unit_id: 'unit-456',
    transcript: 'What devices are in the living room?',
    thread_id: threadId
  })
});

const response2 = await fetch('/v1/roomi', {
  method: 'POST',
  body: JSON.stringify({
    user_id: 'user-123',
    unit_id: 'unit-456',
    transcript: 'Turn them all on',
    thread_id: threadId // Same thread for context
  })
});
```

### 2. Background Task Monitoring
```javascript
const checkTaskStatus = async (taskId) => {
  const response = await fetch(`/v1/task/${taskId}/status`);
  const status = await response.json();
  
  switch (status.status) {
    case 'completed':
      console.log('Task completed:', status.result);
      break;
    case 'running':
      console.log('Task still running...');
      setTimeout(() => checkTaskStatus(taskId), 5000);
      break;
    case 'failed':
      console.error('Task failed:', status.error);
      break;
  }
};
```

### 3. Error Handling
```javascript
const processMessage = async (transcript) => {
  try {
    const response = await fetch('/v1/roomi', {
      method: 'POST',
      body: JSON.stringify({
        user_id: 'user-123',
        unit_id: 'unit-456',
        transcript
      })
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error);
    }
    
    return await response.json();
  } catch (error) {
    console.error('AI processing failed:', error.message);
    throw error;
  }
};
```

## Integration Examples

### Basic Message Processing
```javascript
const response = await fetch('https://ai-prod-ae.roomi-services.com/v1/roomi', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'AWS4-HMAC-SHA256 ...',
    'X-Amz-Content-Sha256': 'SHA256_HASH',
    'X-Amz-Date': '20240115T120000Z'
  },
  body: JSON.stringify({
    user_id: 'user-123',
    unit_id: 'unit-456',
    unit_name: 'Smart Home',
    transcript: 'Turn on the living room lights'
  })
});

const result = await response.json();
console.log('AI Response:', result.response);
```

### Voice Integration
```javascript
// Process voice command
const voiceResponse = await fetch('/v1/roomi', {
  method: 'POST',
  body: JSON.stringify({
    user_id: 'user-123',
    unit_id: 'unit-456',
    transcript: 'What's the temperature in the bedroom?'
  })
});

const result = await voiceResponse.json();

// Generate voice response
const audioResponse = await fetch('/v1/elevenlabs/webhook', {
  method: 'POST',
  body: JSON.stringify({
    text: result.response,
    voice_id: 'voice-123'
  })
});
```

## Next Steps

- [Devices Service API](/api-reference/devices) - Control smart home devices
- [Handler Service API](/api-reference/handler) - Database and communication operations
- [AI Integration Guide](/guides/ai-integration) - Detailed AI service integration
- [Error Handling](/guides/error-handling) - Comprehensive error handling strategies 