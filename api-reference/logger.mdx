---
title: "Logger Service API"
description: "Complete API reference for Roomi's Logger service - CloudWatch logging and monitoring system"
---

## Overview

The Logger service provides centralized logging and monitoring capabilities for the Roomi platform, integrating with AWS CloudWatch for comprehensive system observability. It handles structured logging, performance monitoring, error tracking, and audit trail management across all services.

## Base URL

```
https://logger-{environment}-{region}.roomi-services.com/v1/
```

## Authentication

All API endpoints require AWS Signature Version 4 (SigV4) authentication:

```http
Authorization: AWS4-HMAC-SHA256 Credential=YOUR_ACCESS_KEY/20240115/me-central-1/execute-api/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date, Signature=YOUR_SIGNATURE
X-Amz-Content-Sha256: SHA256_HASH_OF_REQUEST_BODY
X-Amz-Date: 20240115T120000Z
```

## Core Capabilities

### Structured Logging
- **CloudWatch Integration**: Direct logging to AWS CloudWatch Logs
- **Structured Data**: JSON-formatted logs with consistent schema
- **Log Levels**: Debug, Info, Warn, Error, and Fatal levels
- **Context Enrichment**: Automatic addition of metadata and context

### Performance Monitoring
- **Metrics Collection**: System and application performance metrics
- **Custom Metrics**: User-defined business metrics
- **Real-time Monitoring**: Live performance dashboards
- **Alerting**: Automated alerts for performance issues

### Error Tracking
- **Error Aggregation**: Group and categorize errors
- **Stack Traces**: Detailed error information and stack traces
- **Error Trends**: Historical error analysis and trends
- **Root Cause Analysis**: Automated error correlation

### Audit Trail
- **User Actions**: Track all user interactions and changes
- **System Events**: Monitor system-level events and changes
- **Compliance Logging**: Meet regulatory and compliance requirements
- **Data Retention**: Configurable log retention policies

## API Endpoints

### Health Check

<Endpoint method="GET" path="/health" />

Check the health status of the Logger service and CloudWatch connectivity.

**Response:**
```json
{
  "status": "healthy",
  "message": "Logger service is operational",
  "cloudwatch": {
    "status": "connected",
    "log_groups": 15,
    "metrics_namespaces": 8
  },
  "performance": {
    "logs_per_second": 1250,
    "average_latency": "45ms",
    "error_rate": "0.1%"
  },
  "storage": {
    "total_logs": 15000000,
    "storage_used": "2.5GB",
    "retention_days": 90
  },
  "timestamp": "2024-01-15T10:00:00Z"
}
```

### Logging Operations

#### Send Log Entry

<Endpoint method="POST" path="/logs" />

Send a structured log entry to CloudWatch.

**Request Body:**
```json
{
  "level": "info",
  "message": "User authentication successful",
  "service": "auth",
  "user_id": "user-123",
  "unit_id": "unit-456",
  "context": {
    "action": "login",
    "method": "otp",
    "ip_address": "192.168.1.100",
    "user_agent": "RoomiApp/1.0.0"
  },
  "metadata": {
    "session_id": "session-789",
    "processing_time": "1.2s",
    "timestamp": "2024-01-15T10:00:00Z"
  },
  "tags": ["authentication", "user_action"]
}
```

**Response:**
```json
{
  "success": true,
  "log_id": "log-123",
  "cloudwatch_log_stream": "2024/01/15/10",
  "timestamp": "2024-01-15T10:00:00Z"
}
```

#### Send Batch Logs

<Endpoint method="POST" path="/logs/batch" />

Send multiple log entries in a single request for better performance.

**Request Body:**
```json
{
  "logs": [
    {
      "level": "info",
      "message": "Device control successful",
      "service": "devices",
      "user_id": "user-123",
      "context": {
        "device_id": "device-456",
        "action": "turn_on"
      }
    },
    {
      "level": "debug",
      "message": "Processing AI command",
      "service": "ai",
      "user_id": "user-123",
      "context": {
        "command": "Turn on the lights",
        "processing_time": "0.8s"
      }
    }
  ],
  "common_metadata": {
    "unit_id": "unit-456",
    "request_id": "req-789"
  }
}
```

#### Get Logs

<Endpoint method="GET" path="/logs" />

Retrieve logs from CloudWatch with filtering and pagination.

**Query Parameters:**
- `service`: Filter by service name
- `level`: Filter by log level
- `user_id`: Filter by user ID
- `start_time`: Start time for log retrieval
- `end_time`: End time for log retrieval
- `limit`: Number of logs to return
- `next_token`: Pagination token

**Response:**
```json
{
  "logs": [
    {
      "log_id": "log-123",
      "timestamp": "2024-01-15T10:00:00Z",
      "level": "info",
      "message": "User authentication successful",
      "service": "auth",
      "user_id": "user-123",
      "unit_id": "unit-456",
      "context": {
        "action": "login",
        "method": "otp",
        "ip_address": "192.168.1.100"
      },
      "cloudwatch_stream": "2024/01/15/10"
    }
  ],
  "next_token": "next_page_token",
  "total_count": 1250
}
```

### Metrics Operations

#### Send Custom Metric

<Endpoint method="POST" path="/metrics" />

Send a custom metric to CloudWatch.

**Request Body:**
```json
{
  "namespace": "Roomi/UserActions",
  "metric_name": "DeviceControlCount",
  "value": 1,
  "unit": "Count",
  "dimensions": [
    {
      "name": "Service",
      "value": "devices"
    },
    {
      "name": "UnitId",
      "value": "unit-456"
    },
    {
      "name": "ActionType",
      "value": "turn_on"
    }
  ],
  "timestamp": "2024-01-15T10:00:00Z"
}
```

#### Send Batch Metrics

<Endpoint method="POST" path="/metrics/batch" />

Send multiple metrics in a single request.

**Request Body:**
```json
{
  "namespace": "Roomi/SystemPerformance",
  "metrics": [
    {
      "metric_name": "ResponseTime",
      "value": 120,
      "unit": "Milliseconds",
      "dimensions": [
        {
          "name": "Service",
          "value": "ai"
        }
      ]
    },
    {
      "metric_name": "ErrorRate",
      "value": 0.5,
      "unit": "Percent",
      "dimensions": [
        {
          "name": "Service",
          "value": "devices"
        }
      ]
    }
  ],
  "timestamp": "2024-01-15T10:00:00Z"
}
```

#### Get Metrics

<Endpoint method="GET" path="/metrics" />

Retrieve metrics from CloudWatch.

**Query Parameters:**
- `namespace`: CloudWatch namespace
- `metric_name`: Specific metric name
- `start_time`: Start time for metric retrieval
- `end_time`: End time for metric retrieval
- `period`: Time period for aggregation (in seconds)
- `statistics`: Statistical functions (Average, Sum, Min, Max, etc.)

**Response:**
```json
{
  "metrics": [
    {
      "namespace": "Roomi/UserActions",
      "metric_name": "DeviceControlCount",
      "dimensions": [
        {
          "name": "Service",
          "value": "devices"
        }
      ],
      "data_points": [
        {
          "timestamp": "2024-01-15T10:00:00Z",
          "value": 25,
          "unit": "Count"
        },
        {
          "timestamp": "2024-01-15T10:05:00Z",
          "value": 30,
          "unit": "Count"
        }
      ]
    }
  ]
}
```

### Error Tracking

#### Report Error

<Endpoint method="POST" path="/errors" />

Report an error with detailed information for tracking and analysis.

**Request Body:**
```json
{
  "error_type": "ValidationError",
  "message": "Invalid device ID format",
  "service": "devices",
  "user_id": "user-123",
  "unit_id": "unit-456",
  "severity": "warning",
  "stack_trace": "Error: Invalid device ID format\n    at validateDeviceId (/app/validators.js:45:12)\n    at processDeviceControl (/app/controllers.js:23:8)",
  "context": {
    "device_id": "invalid-device-id",
    "action": "turn_on",
    "request_id": "req-789"
  },
  "tags": ["validation", "device_control"]
}
```

#### Get Error Summary

<Endpoint method="GET" path="/errors/summary" />

Get a summary of errors by type, service, and time period.

**Query Parameters:**
- `service`: Filter by service name
- `error_type`: Filter by error type
- `severity`: Filter by severity level
- `start_time`: Start time for error analysis
- `end_time`: End time for error analysis

**Response:**
```json
{
  "summary": {
    "total_errors": 1250,
    "error_rate": "0.5%",
    "by_service": {
      "devices": 450,
      "ai": 300,
      "auth": 200,
      "handler": 300
    },
    "by_type": {
      "ValidationError": 600,
      "NetworkError": 300,
      "AuthenticationError": 200,
      "SystemError": 150
    },
    "by_severity": {
      "critical": 50,
      "error": 400,
      "warning": 600,
      "info": 200
    }
  },
  "trends": {
    "hourly": [
      {"hour": "10:00", "count": 25},
      {"hour": "11:00", "count": 30}
    ]
  }
}
```

### Audit Trail

#### Log Audit Event

<Endpoint method="POST" path="/audit" />

Log an audit event for compliance and security tracking.

**Request Body:**
```json
{
  "event_type": "user_permission_changed",
  "service": "auth",
  "user_id": "user-123",
  "target_user_id": "user-456",
  "action": "grant_permission",
  "details": {
    "permission": "admin_users",
    "reason": "Promoted to admin role",
    "granted_by": "user-789"
  },
  "ip_address": "192.168.1.100",
  "user_agent": "RoomiApp/1.0.0",
  "timestamp": "2024-01-15T10:00:00Z"
}
```

#### Get Audit Logs

<Endpoint method="GET" path="/audit" />

Retrieve audit logs with filtering and search capabilities.

**Query Parameters:**
- `event_type`: Filter by event type
- `user_id`: Filter by user ID
- `service`: Filter by service name
- `start_time`: Start time for audit retrieval
- `end_time`: End time for audit retrieval
- `limit`: Number of audit entries to return
- `next_token`: Pagination token

**Response:**
```json
{
  "audit_logs": [
    {
      "audit_id": "audit-123",
      "timestamp": "2024-01-15T10:00:00Z",
      "event_type": "user_permission_changed",
      "service": "auth",
      "user_id": "user-123",
      "target_user_id": "user-456",
      "action": "grant_permission",
      "details": {
        "permission": "admin_users",
        "reason": "Promoted to admin role"
      },
      "ip_address": "192.168.1.100",
      "user_agent": "RoomiApp/1.0.0"
    }
  ],
  "next_token": "next_page_token",
  "total_count": 500
}
```

### Performance Monitoring

#### Send Performance Data

<Endpoint method="POST" path="/performance" />

Send performance metrics and timing data.

**Request Body:**
```json
{
  "service": "ai",
  "endpoint": "/v1/roomi",
  "method": "POST",
  "response_time": 1200,
  "status_code": 200,
  "user_id": "user-123",
  "unit_id": "unit-456",
  "context": {
    "message_length": 45,
    "processing_steps": 3,
    "external_calls": 2
  },
  "timestamp": "2024-01-15T10:00:00Z"
}
```

#### Get Performance Summary

<Endpoint method="GET" path="/performance/summary" />

Get performance summary and statistics.

**Query Parameters:**
- `service`: Filter by service name
- `endpoint`: Filter by specific endpoint
- `start_time`: Start time for performance analysis
- `end_time`: End time for performance analysis

**Response:**
```json
{
  "summary": {
    "total_requests": 50000,
    "average_response_time": 150,
    "p95_response_time": 300,
    "p99_response_time": 500,
    "error_rate": "0.2%",
    "by_service": {
      "ai": {
        "requests": 20000,
        "avg_response_time": 200,
        "error_rate": "0.1%"
      },
      "devices": {
        "requests": 15000,
        "avg_response_time": 100,
        "error_rate": "0.3%"
      }
    }
  },
  "trends": {
    "hourly": [
      {"hour": "10:00", "avg_response_time": 140},
      {"hour": "11:00", "avg_response_time": 160}
    ]
  }
}
```

## Log Levels

| Level | Description | Use Case |
|-------|-------------|----------|
| `debug` | Detailed debugging information | Development and troubleshooting |
| `info` | General information messages | Normal application flow |
| `warn` | Warning messages | Potential issues that don't stop execution |
| `error` | Error messages | Errors that affect functionality |
| `fatal` | Critical errors | Errors that cause application failure |

## CloudWatch Integration

### Log Groups
The Logger service automatically creates and manages CloudWatch log groups:

- `/roomi/{environment}/application` - Application logs
- `/roomi/{environment}/access` - Access logs
- `/roomi/{environment}/error` - Error logs
- `/roomi/{environment}/audit` - Audit logs
- `/roomi/{environment}/performance` - Performance logs

### Metrics Namespaces
Custom metrics are organized in CloudWatch namespaces:

- `Roomi/UserActions` - User interaction metrics
- `Roomi/SystemPerformance` - System performance metrics
- `Roomi/DeviceOperations` - Device control metrics
- `Roomi/ErrorTracking` - Error and exception metrics

## Error Handling

### Common Error Responses

| Status Code | Description | Solution |
|-------------|-------------|----------|
| `400` | Bad Request | Check request format and required fields |
| `401` | Unauthorized | Verify AWS credentials and signature |
| `413` | Payload Too Large | Reduce log batch size |
| `429` | Rate Limited | Implement exponential backoff |
| `500` | Internal Server Error | Contact support if persistent |
| `503` | Service Unavailable | CloudWatch temporarily unavailable |

### Error Response Format

```json
{
  "error": "CloudWatch service unavailable",
  "error_code": "CLOUDWATCH_ERROR",
  "details": {
    "service": "logger",
    "operation": "send_logs",
    "cloudwatch_error": "ThrottlingException"
  },
  "suggested_action": "Retry the operation after a few seconds",
  "timestamp": "2024-01-15T10:00:00Z"
}
```

## Rate Limiting

The Logger service implements CloudWatch-aware rate limiting:

- **Log Entries**: 1000 logs per minute per service
- **Batch Logs**: 100 batches per minute per service
- **Metrics**: 500 metrics per minute per service
- **Error Reports**: 200 errors per minute per service
- **Audit Events**: 300 audit events per minute per service

## Best Practices

### 1. Structured Logging
```javascript
// Send structured log with context
const logInfo = async (message, context = {}) => {
  const response = await fetch('/v1/logs', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'AWS4-HMAC-SHA256 ...'
    },
    body: JSON.stringify({
      level: 'info',
      message: message,
      service: 'ai',
      user_id: 'user-123',
      unit_id: 'unit-456',
      context: {
        ...context,
        timestamp: new Date().toISOString()
      },
      tags: ['user_action', 'ai_processing']
    })
  });
  
  return await response.json();
};
```

### 2. Error Tracking
```javascript
// Report errors with detailed context
const reportError = async (error, context = {}) => {
  const response = await fetch('/v1/errors', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'AWS4-HMAC-SHA256 ...'
    },
    body: JSON.stringify({
      error_type: error.name,
      message: error.message,
      service: 'ai',
      user_id: 'user-123',
      unit_id: 'unit-456',
      severity: 'error',
      stack_trace: error.stack,
      context: {
        ...context,
        request_id: generateRequestId()
      },
      tags: ['error', 'ai_service']
    })
  });
  
  return await response.json();
};
```

### 3. Performance Monitoring
```javascript
// Track performance metrics
const trackPerformance = async (endpoint, responseTime, statusCode) => {
  const response = await fetch('/v1/performance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'AWS4-HMAC-SHA256 ...'
    },
    body: JSON.stringify({
      service: 'ai',
      endpoint: endpoint,
      method: 'POST',
      response_time: responseTime,
      status_code: statusCode,
      user_id: 'user-123',
      unit_id: 'unit-456',
      context: {
        processing_steps: 3,
        external_calls: 2
      }
    })
  });
  
  return await response.json();
};
```

### 4. Batch Operations
```javascript
// Send multiple logs efficiently
const sendBatchLogs = async (logs) => {
  const response = await fetch('/v1/logs/batch', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'AWS4-HMAC-SHA256 ...'
    },
    body: JSON.stringify({
      logs: logs,
      common_metadata: {
        unit_id: 'unit-456',
        request_id: generateRequestId()
      }
    })
  });
  
  return await response.json();
};
```

## Integration Examples

### Basic Logging Setup
```javascript
const logger = {
  info: async (message, context = {}) => {
    return await fetch('https://logger-prod-ae.roomi-services.com/v1/logs', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'AWS4-HMAC-SHA256 ...'
      },
      body: JSON.stringify({
        level: 'info',
        message: message,
        service: 'ai',
        context: context
      })
    });
  },
  
  error: async (error, context = {}) => {
    return await fetch('/v1/errors', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'AWS4-HMAC-SHA256 ...'
      },
      body: JSON.stringify({
        error_type: error.name,
        message: error.message,
        service: 'ai',
        severity: 'error',
        stack_trace: error.stack,
        context: context
      })
    });
  }
};
```

### Performance Tracking
```javascript
// Track API performance
const trackAPIPerformance = async (endpoint, startTime) => {
  const endTime = Date.now();
  const responseTime = endTime - startTime;
  
  await fetch('/v1/performance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'AWS4-HMAC-SHA256 ...'
    },
    body: JSON.stringify({
      service: 'ai',
      endpoint: endpoint,
      method: 'POST',
      response_time: responseTime,
      status_code: 200,
      context: {
        processing_time: responseTime
      }
    })
  });
};
```

## Next Steps

- [AI Service API](/api-reference/ai) - Intelligent orchestration
- [Devices Service API](/api-reference/devices) - Device control interface
- [Handler Service API](/api-reference/handler) - Database and communication operations
- [Logging Guide](/guides/logging) - Comprehensive logging strategies 